var ApiWrapper=function(){function a(a,b){this.cmsApi=a;this.cache=b}a.prototype.chuj=function(d,a,c){var b=this.cache.get(d);if(b){a.resolve(b);return a}c();return a};a.prototype.getPage=function(b){var a=$.Deferred(),d="getPage_"+b,c=this;this.chuj(d,a,function(){c.cmsApi.getPage({id:b},function(b){c.cache.put(d,b);a.resolve(b)},function(){var a=window.location,b=window.location.hash;window.location.hash="login"})});return a};a.prototype.getPages=function(){var a=$.Deferred();this.cmsApi.getPages(function(b){a.resolve(b)});return a};a.prototype.getAlbum=function(b){var a=$.Deferred();if(b===null){a.resolve(null);return a}this.cmsApi.getAlbum({id:b},function(b){a.resolve(b)});return a};a.prototype.getAlbumPhotos=function(b){var a=$.Deferred(),d=b+"getAlbumPhotos",c=this;if(!b){a.resolve([]);return a}this.chuj(d,a,function(){c.cmsApi.getAlbumPhotos({id:b},function(b){c.cache.put(d,b);a.resolve(b)})});return a};a.prototype.getPhotos=function(){var a=$.Deferred(),c="getAlbumPhotosStream",b=this;this.chuj(c,a,function(){b.cmsApi.getPhotos(function(d){b.cache.put(c,d);a.resolve(d)})});return a};a.prototype.getAlbums=function(){var a=$.Deferred();this.cmsApi.getAlbums(function(b){a.resolve(b)});return a};a.prototype.snapshot=function(b,c){var a=$.Deferred();this.cmsApi.putSnapshot({data:b,path:c},function(b){a.resolve(b)});return a.promise()};a.prototype.checkForSnapshot=function(a,b){b.snapshot&&a.$emit("page-loaded")};return a}();function ngcGdataAlbumDirective(a){var b=new ApiWrapper(a);return{scope:{ngcGdataAlbum:"="},compile:function(){return function(a){b.getAlbum(a.ngcGdataAlbum).then(function(){})}}}};function ngcLazyImage(){var a="loader16.gif";return{scope:{ngcLazyImage:"="},link:function(d,b,c){if(c.loader!==undefined)a=c.loader;b.attr("src",a);d.$watch("ngcLazyImage",function(a){a!==undefined&&b.attr("src",a)})}}};var ngcResponsiveImage=function(){var e=function(a){return a.windowWidth},a=function(a){return a.windowHeight},g=function(a,b){var c=b.FullSize.PhotoUri;if(a>=768&&a<1200)c=b.Large.PhotoUri;if(a>=480&&a<768)c=b.Medium.PhotoUri;if(a<480)c=b.Small.PhotoUri;return c},h=function(c){var b=new Image,a;b.src=c;a=$.Deferred();$(b).load(function(){var b=this;setTimeout(function(){a.resolve(b)},10)});return a},d=function(b){var d=e(b)<b.imageWidth,c=a(b)<b.imageWidth;if(d)b.containerWidth=null;else b.containerWidth=b.imageWidth;if(c){var f=a(b);b.containerWidth=Math.round(b.imageWidth/b.imageHeight*(f-50))}},f=function(a){a.containerWidth=a.imageWidth},c=function(a,i,k){var j=e(a),c,f=g(j,i);a.loading=true;c=setTimeout(function(){a.showLoader=a.loading;a.$emit("ngc-responsive-image-loading",a.loading);a.$digest()},200);a.imagePromise=h(f).done(function(e){a.imageWidth=e.width;a.imageHeight=e.height;d(a);a.source=f;a.loading=false;a.showLoader=false;clearTimeout(c);a.$emit("ngc-responsive-image-loading",false);a.$emit("ngc-responsive-image-skipping",false);a.skipping=false;b(k);a.$apply()})},b=function(a){a.css("position","relative");a.css("margin","0 auto");a.css("left","auto");a.css("top","auto")};return{scope:{galleryImage:"="},controller:function(a){a.containerWidth="16";a.windowWidth=$(window).width();a.windowHeight=$(window).height();a.isFullSize=function(){return a.imageWidth<=a.containerWidth};a.isFullSizeCssClass=function(){return!a.isFullSize()?"icon-resize-full":"icon-resize-small"};a.showFullSize=function(){if(!a.isFullSize())f(a);else d(a)};a.isMovable=function(){return a.isOverFlowable()&&a.isFullSize()?"movable":""};a.fullSizeTooltip=function(){return a.isFullSize()?"P\u0159izp\u016fsobit na str\u00e1nku":"Zobrazit p\u016fvodn\u00ed velikost"};a.isOverFlowable=function(){return a.windowHeight<a.imageHeight||a.windowWidth<a.imageWidth};a.getCssWidth=function(a){return a===null?"auto":a+"px"};a.getCssHeight=function(a){return a===null?"auto":a+"px"}},restrict:"E",replace:true,templateUrl:"template.ngcResponsiveImage.html",compile:function(){return function(a,e){var d=e.find(".draggable");a.source=null;a.$watch("galleryImage",function(b){if(b===undefined)return;if(a.imagePromise)if(a.imagePromise.state()==="pending"){a.imagePromise.reject();a.skipping=true;a.$emit("ngc-responsive-image-skipping",true)}c(a,b,d)});a.$watch("containerWidth",function(a,e){var c=e>a;d.css("width",a);c&&b(d)});a.$on("windowChanged",function(d,b){a.windowWidth=b.width;a.windowHeight=b.height;c(a,a.galleryImage)})}}}};function simpleDragDirective(){var a=function(a,b,e,f){var c,d;if(a.pageX&&a.pageY){c=a.pageX-e;d=a.pageY-f;b.css("left",c);b.css("top",d)}};return{link:function(e,b){var c=0,d=0;b.bind({dragstart:function(f){var e=f.originalEvent;c=e.offsetX;d=e.offsetY;a(e,b,c,d);b.css("position","absolute")},dragover:function(e){var g=e.originalEvent;e.stopPropagation();e.preventDefault();var f=e.originalEvent.dataTransfer;f.effectAllowed=f.dropEffect="none";a(g,b,c,d)},dragenter:function(a){a.stopPropagation();a.preventDefault();var b=a.originalEvent.dataTransfer;b.effectAllowed=b.dropEffect="none"}})}}};var homeController=["$scope","test",function(a,b){b.getPages().then(function(b){a.pages=b.data});a.homeImagesBegin=[1,2,3,4,6,1];a.homeImagesEnd=[1,2,3,3];b.getPhotos().then(function(b){a.homeImagesBegin=b.data.slice(0,6);a.homeImagesEnd=b.data.slice(7,11);return b}).then(function(c){b.checkForSnapshot(a,c)})}];var pageController=["$scope","test","$routeParams",function(a,b,c){a.link=c.link;b.getPage(a.link).then(function(b){a.page=b.data;return b}).then(function(c){setTimeout(function(){b.checkForSnapshot(a,c)},3e3)})}];var loginController=["$scope","cmsApi",function(a,c){var e=new ApiWrapper(c),b=function(b){if(b)a.message=null;a.loading=b===null||typeof b==="undefined"?true:b};b();c.getRequestToken(function(c){a.RequestToken=c.RequestToken;b(false)},function(){a.message="P\u0159ihla\u0161ovac\u00ed slu\u017ebe je nedostupn\u00e1."});var d=function(b){var a;switch(b){case 401:a="\u0160patn\u00e9 heslo nebo login";break;case 400:case 500:a=".";break;default:a="Vyskytla se nezn\u00e1m\u00e1 chyba ".status}return a};a.submit=function(){b();var e={};e.UserName=a.UserName;e.Password=a.Password;e.RequestToken=a.RequestToken;c.login(e,function(){window.location.hash="home";b(false)},function(c){a.message=d(c.status);b(false)})}}];function userDataForm(a,d,b){a.link=b.link;var c=function(b){var a;switch(b){case 401:a="Pro odesl\u00e1n\u00ed formul\u00e1\u0159e je pot\u0159eba se p\u0159ih\u00e1sit. ";break;case 400:case 500:a=".";break;default:a="Vyskytla se nezn\u00e1m\u00e1 chyba ".status}return a};a.post=function(){d.putUserData({data:a.data,key:a.key},function(){},function(b){a.$emit("set-message",c(b.status))})};a.serialized=function(){JSON.stringify(a.data)}};var gridelementGdataAlbumCtrl=["$scope","test","$routeParams","$location","$rootScope",function(a,f,c,b,d){a.gdataAlbumId=e();a.route={link:c.link};function e(){var b=a.gridelement.Content;return b!==null?b.gdataAlbumId:null}console.log(a.gdataAlbumId);f.getAlbumPhotos(a.gdataAlbumId).then(function(c){var b=c.data.slice();a.firstPhoto=b.splice(0,1)[0];a.gdataAlbumPhotos=b;a.gdataAlbumPhotosAll=c});a.showImage=function(e,c){b.search("i",c);b.search("g",e);d.$broadcast("getAlbumPhotosSuccess",a.gdataAlbumPhotosAll,c)}}];var simplehtml=function(b){var c=new Showdown.converter,a=b.getGridElement();b.ContentToHtml=function(){return c.makeHtml(a.Resources&&a.Resources.text?a.Resources.text.Value:"")}};var galleryImageViewerController=["$scope","$routeParams","test","$location",function(a,e,i,d){a.$on("getAlbumPhotosSuccess",function(e,d,b){a.gallery=d;c(b)});a.$on("global-keydown",function(d,b){if(!h())return;var c=b.keyCode;switch(c){case 27:a.close();break;case 37:a.prev();break;case 32:case 39:a.next()}});a.$on("$locationChangeSuccess",function(){var c=b();if(typeof c==="undefined")a.gallery=null});a.$on("ngc-responsive-image-loading",function(c,b){a.loading=b;a.$$phase!=="$digest"&&a.$digest()});a.$on("ngc-responsive-image-skipping",function(c,b){a.skipping=b;a.$$phase!=="$digest"&&a.$digest()});g();function h(){return a.gallery!==null&&a.gallery!==undefined}function b(){return e.i}function f(){return e.g}function c(b){if(!a.gallery){a.newindex=b;i.getAlbumPhotos(f()).then(function(c){a.gallery=c.data;a.image=a.gallery[b]});return}a.image=a.gallery[b]}function g(){var d=f(),a=b();typeof a!=="undefined"&&typeof d!=="undefined"&&c(a)}a.close=function(){location.hash="!"+d.path()};a.next=function(){var f=a.gallery.length,e=b();e++;if(e>=f)e=0;c(e);d.search("i",e)};a.prev=function(){var f=a.gallery.length,e=b();e--;if(e<=0)e=f-1;c(e);d.search("i",e)}}];var pController=["$scope","test","$routeParams","$location",function(a,f,d,e){a.link=d.link;var b=function(){var c=e.search().g,b=d.elementIndex,a;a=!isNaN(b)?b:0;if(!isNaN(c))a=c;return a};f.getPage(a.link).then(function(c){a.page=c.data;a.currentGridElement=a.page.GridElements[b()];return c}).then(function(b){f.checkForSnapshot(a,b)});var c=function(b){e.search("g",b);a.currentGridElement=a.page.GridElements[b]};a.next=function(){var d=b(),e=a.page.GridElements.length;d++;if(d>e-1)return;c(d)};a.prev=function(){var a=b();if(a<=0)return;a--;c(a)}}];angular.module("appConfigModule",[]).value("appConfig",{}).factory("chujFactory",function(){return"laskndalksd"+$(window).width()});angular.module("apiModule",["ngResource","appConfigModule"]).factory("cmsApi",["$resource",function(a){return a("Service/cmsClientPHPService/:service",{service:"serverProxy.php"},{getPage:{method:"GET",isArray:false,params:{action:"getPage"}},getRequestToken:{method:"GET",isArray:false,params:{action:"getLogin"}},login:{method:"POST",isArray:false,params:{action:"PostLogin",service:"login.php"}},post:{method:"POST",isArray:false,params:{action:"getLogin"}},getPages:{method:"GET",isArray:false,params:{action:"getPages"}},getAlbums:{method:"GET",isArray:false,params:{action:"getAlbums"}},getAlbum:{method:"GET",isArray:false,params:{action:"getAlbum"}},getAlbumPhotos:{method:"GET",isArray:false,params:{action:"getAlbumPhotos"}},getPhotos:{method:"GET",isArray:false,params:{action:"getPhotos"}},putUserData:{method:"PUT",isArray:false,params:{service:"postData.php"}},putSnapshot:{method:"PUT",isArray:false,params:{service:"snapshot.php"}}})}]);angular.module("HashBangURLs",[]).config(["$locationProvider",function(a){a.hashPrefix("!")}]);var module=angular.module("defaultClient",["apiModule","ui.keypress","ui.event","ui.bootstrap","HashBangURLs"]);module.factory("cache",["$cacheFactory",function(a){return a("cmsCache")}]);module.factory("test",["cmsApi","cache",function(a,b){return new ApiWrapper(a,b)}]);module.config(["$routeProvider",function(a){a.when("/page/:link",{reloadOnSearch:false,controller:pageController,templateUrl:"template.page.html",resolve:{api:"test"}}).when("/p/:link/:elementIndex",{reloadOnSearch:false,controller:pController,templateUrl:"template.p.html"}).when("/home",{controller:homeController,templateUrl:"template.home.html"}).when("/login",{controller:loginController,templateUrl:"template.login.html"}).otherwise({redirectTo:"/home"})}]);module.directive("shortcut",function(){return{restrict:"E",replace:true,scope:true,link:function(a){jQuery(document).on("keydown",function(b){a.$apply(a.keyPressed(b))})}}});module.directive("gridelement",["$compile","$templateCache",function(b,a){return{scope:{grid:"=",gridelement:"="},link:function(c,d){c.$watch("gridelement",function(h){if(!h)return;var g=c.gridelement.Skin||"",f=a.get(c.gridelement.Type+g+".thtml"),e=b(f)(c);d.html(e)});c.getGridElement=function(){return c.gridelement}}}}]);module.directive("ngcGdataAlbum",["cmsApi",ngcGdataAlbumDirective]);module.directive("ngcLazyImage",ngcLazyImage);module.directive("ngcSimpleDrag",simpleDragDirective);module.directive("ngcResponsiveImage",ngcResponsiveImage);module.controller("appController",["$scope","test","$location",function(a,c,b){a.globalKeydown=function(b){a.$broadcast("global-keydown",b)};a.$on("set-message",function(c,b){a.message=b});a.$on("page-loaded",function(){var a=$("html").html();console.log(b.path());c.snapshot(a,b.path())})}])